<!DOCTYPE html>
<html>

<head>
  <link rel="canonical" href="https://3618321s.github.io/Bonus/" />
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1.0, user-scalable=0" />

  <title>好過年年好過過好年 - Let's Start</title>
  <meta name="description"
    content="參考午餐吃什麼？用抽獎方式來決定今天的午餐吧！由 August 開發，以 Google Sheets 當資料庫，介接 Google Map Embed API，輕鬆好管理。" />
  <!-- 在這裡貼上 -->
  <link rel="stylesheet" href="https://pro.fontawesome.com/releases/v5.10.0/css/all.css"
    integrity="sha384-AYmEC3Yw5cVb3ZcuHtOA93w35dYTsvhLPVnYs9eStHfGJvOvKxVfELGroGkvsg+p" crossorigin="anonymous" />

  <link rel="shortcut icon" href="https://3618321s.github.io/Bonus/assets/img/S__15302660.ico" />
  <meta property="og:url" content="https://letswritetw.github.io/letswrite-food-check/" />
  <!-- <meta property="og:site_name" content="Let's Write" /> -->
  <meta property="og:title" content="好過年年好過過好年 - Let's Start" />
  <meta property="og:description"
    content="參考午餐吃什麼？用抽獎方式來決定今天的午餐吧！由 August 開發，以 Google Sheets 當資料庫，介接 Google Map Embed API，輕鬆好管理。" />
  <meta property="og:image" content="https://letswritetw.github.io/letswrite-food-check/assets/img/bg-food.jpg" />
  <meta itemprop="name" content="好過年年好過過好年 - Let's Start" />
  <meta itemprop="description"
    content="參考午餐吃什麼？用抽獎方式來決定今天的午餐吧！由 August 開發，以 Google Sheets 當資料庫，介接 Google Map Embed API，輕鬆好管理。" />
  <meta itemprop="image" content="https://letswritetw.github.io/letswrite-food-check/assets/img/bg-food.jpg" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/7.0.0/normalize.min.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" />
  <link rel="stylesheet" href="assets/css/main.css" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css" />
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.1/dist/jquery.slim.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
  <script src="https://malsup.github.io/jquery.blockUI.js"></script>

  <!-- Google Tag Manager-->
  <!-- <script>
		(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
		new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
		j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
		'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
		})(window,document,'script','dataLayer','GTM-PGQ9WQT');
	</script> -->
</head>

<body>
  <!-- Google Tag Manager (noscript)-->
  <!-- <noscript>
      <iframe
        src="https://www.googletagmanager.com/ns.html?id=GTM-PGQ9WQT"
        height="0"
        width="0"
        style="display: none; visibility: hidden"
      ></iframe>
    </noscript> -->

  <!--  背景圖  -->
  <main class="full-block">
    <!--  主要內容  -->
    <div class="container" style="margin-top: 30px">
      <div class="row">
        <div class="col-sm-6">
          <div class="main-block">
            <!--  顯示區塊  -->
            <section class="god">
              <h1>
                <span class="wrap">
                  <span>抽起來!!!</span>
                </span>
              </h1>
            </section>

            <!--  按鈕  -->
            <section class="btns">
              <!--  start  -->
              <a class="btn-start" href="#">
                <span class="line top -h"></span>
                <span class="line right -v"></span>
                <span class="line bottom -h"></span>
                <span class="line left -v"></span>
              </a>
            </section>
          </div>
        </div>
        <!-- <div class="col-sm-2">
          <div class="container text-center">
            <h5>all</h5>
            <ul class="trainList"></ul>
          </div>
        </div> -->

        <div class="col-sm-3" style="visibility:hidden" id="Bonus">
          <div class="container text-center" style="margin-left: 30px;">
            <h5>抽獎金額</h5>
            <ul class="test"></ul>
          </div>
        </div>
        <div class="col-sm-3">
          <div class="container text-center" style="margin-left: 30px;">
            <h5>獎項</h5>
            <div class="row">
              <div class="col-sm-6">
                <ul class="trainList1"></ul>
              </div>
              <div class="col-sm-6">
                <ul class="trainList"></ul>
              </div>
            </div>
          </div>

        </div>
      </div>
    </div>
  </main>
  <!--  github link  -->
  <div class="github">
    <a class="btn btn-default" href="#" id="btplay">
      <i class="fa fa-play" aria-hidden="true"></i>
    </a>
  </div>
  <div class="displaydiv">
    <a class="btn btn-default" href="#" id="btnblock">
      <i class="fa fa-expand" aria-hidden="true"></i>
    </a>
  </div>
  <div class="dishidden">
    <a class="btn btn-default" href="#" id="btnhidden">
      <i class="fa fa-angellist" aria-hidden="true"></i>
    </a>
  </div>
  <audio src="assets/happynewyear.mp3" id="MyMp3" autoplay loop>
    遇到不支援的瀏覽器會出現這行字
  </audio>
  <script>
    var btn_open = document.querySelector("#btnblock");
    btn_open.onclick = function (){
      document.getElementById("Bonus").style.visibility = "visible";
    }
    var btn_hidden = document.querySelector("#btnhidden");
    btn_hidden.onclick = function (){
      document.getElementById("Bonus").style.visibility = "hidden";
    }    
    var btnplayer = document.querySelector("#btplay");
    var emymp3 = document.querySelector("#MyMp3");
    btnplayer.onclick = function () {
      emymp3.play();
    };
    window.onbeforeunload = function (event) {
      //event.preventDefault(); //chrome無效, ff有效, ie11有效
      event.returnValue = ""; //chrome有效, ff無效, ie11有效
      //return ''; //chrome有效, ff有效, ie11有效
    };
    // Maps Embed API、Google Sheets API 的 金鑰
    // 可由 https://console.developers.google.com/apis 申請
    const embedApiKey = "AIzaSyDXC-ahKOIns3_qjoh9y3XXYgs3eFt7XuY";

    const uri =
      "https://sheets.googleapis.com/v4/spreadsheets/1BrBZECi3UmUaPle0M75xc99RYb5dXuZmmUrM6j4aNSY/values/BONUS?alt=json&key=" +
      embedApiKey;
    //https://docs.google.com/spreadsheets/d/1BrBZECi3UmUaPle0M75xc99RYb5dXuZmmUrM6j4aNSY/edit#gid=678916723
    const duration = 2000; // 拉霸效果執行多久

    fetch(uri)
      .then((res) => res.json())
      .then((data) => {
        let all = []; //序號
        let all_Bonus = []; //金額
        let pass = []; //抽過序號
        let result = []; //沒抽過

        const d = data.values,
          len = d.length;

        //塞入全部陣列中
        for (let j = 1; j < len; j++) {
          all.push(d[j][0]);
          all_Bonus.push(d[j][1]);
        }

        let B500 = 0;
        let B200 = 0;
        let B100 = 0;

        var trainList = document.querySelector(".trainList");
        var test = document.querySelector(".test");
        var testil = document.createElement("li");
        if (result.length == 0) {
          //跑迴圈將li新增進去
          for (let z = 0; z < all.length; z++) {
            // var li = document.createElement("li");
            // li.innerHTML = "<div><span id=" + z + ">" + all_Bonus[z] + "</span></div>";
            // trainList.appendChild(li);
            //計算數量
            if (all_Bonus[z] / 500 == 1) {
              B500 += 1;
            } else if (all_Bonus[z] / 200 == 1) {
              B200 += 1;
            } else {
              B100 += 1;
            }
          }
          testil.innerHTML =
            "<div><span>準備獎項<br/>500元 x 2 個<br/>200元 x 5 個<br/>100元 x 33 個<br/><br/>剩餘獎項</span></div><div><span>500元 x " +
            B500 +
            " 個</span></div><div><span>200元 x " +
            B200 +
            " 個</span></div><div><span>100元 x " +
            B100 +
            " 個</span></div>";
          test.appendChild(testil);
        } else {
          //跑迴圈將li新增進去
          for (let z = 0; z < result.length; z++) {
            var li = document.createElement("li");
            let sn = result[z] - 1;
            li.innerHTML =
              "<div><span id=" + z + ">" + result[z] + "</span></div>";
            trainList.appendChild(li);
          }
        }

        // 點擊按鈕後執行
        let r; // 亂數
        let max, min; // 陣列的最大、小值
        let txt; // 結果

        // 按鈕
        const btn = document.querySelector(".btn-start");

        btn.addEventListener(
          "click",
          (e) => {
            e.preventDefault();
            $.blockUI({
              message: '<h1>緊張緊張！刺激刺激！</h1>',
              css: {
                border: 'none',
                padding: '15px',
                backgroundColor: '#000',
                '-webkit-border-radius': '10px',
                '-moz-border-radius': '10px',
                opacity: .5,
                color: '#fff'
              }
            });
            setTimeout($.unblockUI, 1800);
            // 選店家 fn
            const chooseShop = (toggle) => {
              // 取亂數 fn
              r = () => {
                max = toggle.length - 1;
                min = 0;
                return Math.floor(Math.random() * (max - min + 1)) + min;
              };

              // 清空、插入選項
              let input = document.querySelector(".wrap");
              input.innerHTML = "";
              for (let i = 0; i < toggle.length; i++) {
                input.insertAdjacentHTML(
                  "beforeend",
                  "<span>" + all_Bonus[i] + "</span>"
                );
              }

              // 禁止按鈕再被點擊
              e.target.classList.add("not-allow");

              // 加入動畫 class name
              const list = document.querySelectorAll(".wrap > span");
              Array.prototype.forEach.call(list, (l) =>
                l.classList.add("span-" + (toggle.length - 1))
              );

              // 亂數決定中選店家
              txt = toggle[r()];
              context = all_Bonus[txt - 1];
              list[0].innerText = context;

              pass.push(txt);

              // 移除動畫
              setTimeout(() => {
                // 停止拉霸動畫
                Array.prototype.forEach.call(list, (l) =>
                  l.removeAttribute("class")
                );
                //按鈕恢復
                e.target.classList.remove("not-allow");

                var size = all.length / 2;
                //顯示被選中的值
                var trainList1 = document.querySelector(".trainList1");
                //跑迴圈將li新增進去
                var li = document.createElement("li");
                li.innerHTML = "";
                for (let a = 0; a < pass.length; a++) {
                  let sn = pass[a] - 1;
                  let num = a + 1;
                  li.innerHTML =
                    "<div><span id=" +
                    a +
                    ">" +
                    num +
                    ". " +
                    all_Bonus[sn] +
                    "</span></div>";
                  if (a < size) {
                    trainList1.appendChild(li);
                  }
                  else {
                    trainList.appendChild(li);
                  }
                }

                //整理原本資料
                result = all
                  .filter((e) => {
                    return pass.indexOf(e) === -1;
                  })
                  .concat(
                    pass.filter((f) => {
                      return all.indexOf(f) === -1;
                    })
                  );
                testil.innerHTML = "";
                B500 = 0;
                B200 = 0;
                B100 = 0;
                //計算剩餘數量
                for (let b = 0; b < result.length; b++) {
                  //計算數量
                  if (all_Bonus[result[b] - 1] / 500 == 1) {
                    B500 += 1;
                  } else if (all_Bonus[result[b] - 1] / 200 == 1) {
                    B200 += 1;
                  } else {
                    B100 += 1;
                  }
                }
                testil.innerHTML =
                "<div><span>準備獎項<br/>500元 x 2 個<br/>200元 x 5 個<br/>100元 x 33 個<br/><br/>剩餘獎項</span></div><div><span>500元 x " +
                  B500 +
                  " 個</span></div><div><span>200元 x " +
                  B200 +
                  " 個</span></div><div><span>100元 x " +
                  B100 +
                  " 個</span></div>";
                test.appendChild(testil);
              }, duration);
            };

            if (pass.length == 0) {
              //開始執行
              chooseShop(all);
            } else if (result.length == 0) {
              btn.disabled = false;
            } else {
              //開始執行
              chooseShop(result);
            }
          },
          false
        );
      });
  </script>
</body>

</html>